<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Zindigon — From imagination to expectation</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Zindigon — where fun, magic, and creativity live. Anime, games, streams, and more." />

  <!---------- Fonts ---------->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700;800;900&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#07070d; --bg2:#0b0b16; --ink:#e6e6ff; --muted:#aab0ff;
      --accent:#7c4dff; --accent-2:#00e0ff; --accent-3:#ff3bf5;
      --card:#0f0f1d; --ring:rgba(124,77,255,.35); --radius:16px;
      --shadow:0 20px 60px rgba(0,0,0,.55), inset 0 0 30px rgba(124,77,255,.12);
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; padding:0;
      background: radial-gradient(1200px 800px at 50% -200px, #111229 0%, var(--bg) 60%) fixed;
      color:var(--ink);
      font-family:system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'JetBrains Mono', 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji','Segoe UI Emoji', sans-serif;
    }

    /*---------- Background layers ----------*/
    #starfield{position:fixed; inset:0; z-index:-2;}
    .aurora{
      position:fixed; inset:-20vh -10vw; z-index:-1; pointer-events:none;
      background:
        radial-gradient(60vw 60vh at 15% 10%, rgba(0,224,255,.08), transparent 60%),
        radial-gradient(70vw 70vh at 85% -5%, rgba(255,59,245,.06), transparent 60%),
        radial-gradient(80vw 80vh at 50% -15%, rgba(124,77,255,.10), transparent 60%);
      filter: blur(30px) saturate(120%);
    }

    /*---------- Header ----------*/
    header{
      position:sticky; top:0; z-index:50;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(10,10,22,.65), rgba(10,10,22,.25));
      border-bottom: 1px solid rgba(124,77,255,.25);
    }
    .nav{max-width:1200px; margin:0 auto; padding:8px 16px; display:flex; align-items:center; gap:14px;}
    .brand{display:flex; align-items:center; gap:12px; text-decoration:none;}
    .logo-img{ height:28px; width:auto; display:block; border-radius:8px; box-shadow:0 0 18px rgba(124,77,255,.35);} 
    .logo-text{font-family:'Cinzel', serif; letter-spacing:.6px; font-weight:800; font-size:1.1rem; line-height:1; color:white; text-shadow:0 0 10px rgba(124,77,255,.45), 0 0 25px rgba(0,224,255,.25);} 
    .spacer{flex:1}

    .tabs{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .tab-btn{
      appearance:none; border:none; cursor:pointer;
      color:var(--muted); background:transparent;
      padding:10px 14px; border-radius:12px; font-weight:600; outline:none; display:inline-flex; align-items:center; gap:8px;
    }
    .tab-btn:hover{color:var(--ink)}
    .tab-btn.active{
      color:white; background:linear-gradient(180deg, rgba(124,77,255,.35), rgba(124,77,255,.12));
      box-shadow: inset 0 0 0 1px rgba(124,77,255,.45), var(--shadow);
    }

    /*---------- HERO ----------*/
    .hero{ max-width:1200px; margin:24px auto 20px; padding:24px 16px; display:grid; grid-template-columns:minmax(0, 4fr) minmax(260px, 1fr); gap:20px; }
    @media (max-width:980px){ .hero{grid-template-columns:1fr; gap:14px; padding:20px 16px;} }

    .arcane-card{ background: linear-gradient(180deg, rgba(12,12,28,.85), rgba(14,14,32,.65)); border:1px solid rgba(124,77,255,.25); border-radius:var(--radius); box-shadow:var(--shadow); }
    .hero-card{ padding:22px; margin-bottom:20px; position:relative; overflow:clip; }
    .hero-title{ font-family:'Cinzel', serif; font-weight:900; font-size: clamp(2.2rem, 3.8vw, 4rem); line-height:1.05; letter-spacing:.8px; background: linear-gradient(92deg, #fff 0%, #dfe4ff 40%, #a5b4ff 60%, #ffffff 100%); -webkit-background-clip:text; background-clip:text; color:transparent; text-shadow: 0 0 35px rgba(124,77,255,.45), 0 0 14px rgba(0,224,255,.25); }
    .hero-sub{ margin-top:10px; color:#d9dcff; font-weight:600; letter-spacing:.4px; text-shadow:0 0 12px rgba(124,77,255,.25); }
    .sigils{ position:absolute; inset:-20% -10% auto auto; height:180%; background: radial-gradient(40% 40% at 25% 30%, rgba(0,224,255,.13), transparent 60%), radial-gradient(35% 35% at 70% 60%, rgba(255,59,245,.10), transparent 60%), conic-gradient(from 0deg, rgba(124,77,255,.12), rgba(124,77,255,0) 40%, rgba(0,224,255,.12) 60%, rgba(0,224,255,0)); filter: blur(45px) saturate(140%); pointer-events:none; transform: translateZ(0); }

    .actions{display:flex; gap:12px; flex-wrap:wrap; margin-top:18px;}
    .btn{ display:inline-flex; align-items:center; gap:10px; padding:12px 16px; border-radius:14px; font-weight:700; letter-spacing:.2px; text-decoration:none; color:white; background: radial-gradient(80% 120% at 0% 0%, rgba(0,224,255,.35), transparent 40%), linear-gradient(180deg, rgba(124,77,255,.9), rgba(124,77,255,.65)); box-shadow: 0 8px 30px rgba(124,77,255,.35); border:1px solid rgba(124,77,255,.55); }
    .btn:hover{transform:translateY(-1px); box-shadow:0 12px 40px rgba(124,77,255,.45);} 
    .btn-ghost{ color:var(--ink); background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); box-shadow: inset 0 0 0 1px rgba(255,255,255,.06); }
    .icon{width:18px; height:18px; display:inline-block;}
    .mini{ color:var(--muted); font-size:.92rem; line-height:1.4; }

    /*---------- Frames ----------*/
    .youtube-frame,.twitch-frame{ width:100%; aspect-ratio:16/9; border:0; border-radius:12px; box-shadow:var(--shadow); }

    /*---------- Layout below ----------*/
    main{ max-width:1200px; margin:12px auto 80px; padding:0 20px; }
    .section{ display:none; margin-top:16px; padding:22px; border-radius:var(--radius); background: linear-gradient(180deg, rgba(12,12,28,.75), rgba(13,13,30,.6)); border: 1px solid rgba(124,77,255,.24); box-shadow: var(--shadow); animation: rise .35s ease-out; }
    .section.show{ display:block; }
    @keyframes rise{ from{ transform:translateY(6px); opacity:0 } to{ transform:translateY(0); opacity:1 } }

    .grid{ display:grid; gap:16px; grid-template-columns: repeat(12, 1fr); }
    .col-12{ grid-column: span 12; } .col-8{grid-column: span 8;} .col-6{ grid-column: span 6; } .col-4{ grid-column: span 4; }
    @media (max-width:980px){ .col-8,.col-6{grid-column:span 12} .col-4{grid-column: span 12} }

    .card{ background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.12); border-radius:14px; padding:16px; box-shadow: inset 0 0 0 1px rgba(255,255,255,.04); }
    .h{ font-family:'Cinzel', serif; font-weight:800; letter-spacing:.6px; margin:0 0 8px; color:#fff; text-shadow: 0 0 16px rgba(124,77,255,.35); }
    .p{ margin:0; color:#d7dcff; }

    footer{ max-width:1200px; margin:60px auto 40px; padding:0 20px; color:var(--muted); text-align:center; }
    .support{ display:inline-flex; align-items:center; gap:10px; margin-top:14px; padding:12px 16px; border-radius:14px; text-decoration:none; font-weight:800; color:#101015; background: linear-gradient(180deg, #00e0ff, #7c4dff); box-shadow: 0 12px 40px rgba(0,224,255,.35), 0 8px 25px rgba(124,77,255,.35); border:1px solid rgba(255,255,255,.24); }

    a{ color:inherit }

    /* Partners */
    .partner-card{ display:grid; grid-template-columns: 1.5fr 1fr; gap:14px; }
    @media (max-width:980px){ .partner-card{grid-template-columns:1fr;} }
    .partner-meta{ display:grid; align-content:start; gap:8px; }
    .partner-title{ font-weight:900; font-size:1.2rem; }
    .partner-badges{ display:flex; gap:8px; flex-wrap:wrap; }
    .badge{ font-size:.78rem; padding:6px 10px; border-radius:999px; border:1px solid rgba(255,255,255,.14); color:#dfe3ff; background:rgba(255,255,255,.04); }

    /* Leaderboard styling */
    .leaderboard{ margin-top:10px; overflow:auto; }
    .lb-table{ width:100%; border-collapse:collapse; text-align:left; }
    .lb-table th, .lb-table td{ padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08); }
    .lb-table th{ color:#fff; font-weight:900; background:linear-gradient(180deg, rgba(124,77,255,.25), rgba(124,77,255,.08)); position:sticky; top:0; }
    .lb-row:nth-child(odd){ background:rgba(255,255,255,.02); }
    .lb-rank{ font-weight:900; width:64px; }
    .lb-name{ font-weight:800; }
    .lb-guild{ color:#d0d4ff; }
    .lb-score{ text-align:right; font-weight:900; }
    .lb-bad{ color:#ff99a5; }
  </style>
</head>
<body>
  <canvas id="starfield" aria-hidden="true"></canvas>
  <div class="aurora" aria-hidden="true"></div>

  <header>
    <nav class="nav">
      <a class="brand" href="#" data-tab="home" aria-label="Zindigon Home">
        <img class="logo-img" src="https://i.imgur.com/xnxvXeA.jpeg" alt="Zindigon logo" />
        <span class="logo-text">Zindigon</span>
      </a>
      <div class="spacer"></div>
      <div class="tabs" role="tablist" aria-label="Sections">
        <button class="tab-btn active" data-tab="home" role="tab" aria-selected="true">Home</button>
        <button class="tab-btn" data-tab="projects" role="tab">Projects</button>
        <button class="tab-btn" data-tab="games" role="tab">Games</button>
        <button class="tab-btn" data-tab="partners" role="tab">Partners</button>
        <button class="tab-btn" data-tab="about" role="tab">About</button>
        <button class="tab-btn" data-tab="contact" role="tab">Contact</button>
      </div>
    </nav>
  </header>

  <!---------- HERO ---------->
  <section id="home" class="hero section show" aria-labelledby="hero-title">
    <!---------- LEFT column: hero + featured video ---------->
    <div>
      <div class="hero-card arcane-card">
        <div class="sigils"></div>
        <h1 id="hero-title" class="hero-title">Where Fun, Magic, and Creativity Live.</h1>
        <div class="hero-sub">From imagination to expectation</div>
        <div class="actions" style="margin-top:18px">
          <a class="btn" href="https://youtube.com/@zindigon?si=N-CuSjB1Cqsr8p0C" target="_blank" rel="noopener">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M23.5 6.2a4 4 0 0 0-2.8-2.8C18.7 3 12 3 12 3s-6.7 0-8.7.4A4 4 0 0 0 .5 6.2 41 41 0 0 0 0 12a41 41 0 0 0 .5 5.8 4 4 0 0 0 2.8 2.8C5.3 21 12 21 12 21s6.7 0 8.7-.4a4 4 0 0 0 2.8-2.8A41 41 0 0 0 24 12a41 41 0 0 0-.5-5.8ZM9.6 15.5V8.5L15.9 12l-6.3 3.5Z"/></svg>
            YouTube
          </a>
          <a class="btn btn-ghost" href="https://www.tiktok.com/@zindigon96?_t=ZP-90xFluWfH0Z&_r=1" target="_blank" rel="noopener">
            <svg class="icon" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M16.7 3.1c.7 1.3 2 2.3 3.5 2.6l1.1.2v3a8 8 0 0 1-4.6-1.5v7.1a6.5 6.5 0 1 1-6.6-6.5c.4 0 .7 0 1 .1v3.4a3 3 0 0 0-1-.2 3.1 3.1 0 1 0 3.1 3.1V2h3.5Z"/></svg>
            TikTok
          </a>
          <a class="btn" href="#support" data-tab="contact">✨ Support Us</a>
        </div>
        <p class="mini" style="margin-top:10px">Explore original anime projects, game worlds, and live streams—crafted by Zindigon.</p>
      </div>
      <div class="youtube-card arcane-card">
        <h3 class="h">Featured Video</h3>
        <iframe class="youtube-frame" title="Zindigon YouTube Video" src="https://www.youtube.com/embed/qTNXxz_y9-w?si=Xb8x613LgAFs9zHl" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
      </div>
    </div>

    <!---------- RIGHT column: Featured Partner live embed ---------->
    <div class="sidebar">
      <div class="twitch-card arcane-card" id="featuredPartner">
        <h3 class="h">Live Now</h3>
        <div id="featuredPlayer"></div>
        <div class="actions"><a class="btn btn-ghost" id="featuredLink" href="#" target="_blank" rel="noopener">Open Channel</a></div>
        <p class="mini" id="featuredMeta">Follow to catch the next stream!</p>
      </div>
    </div>
  </section>

  <main>
    <!---------- PROJECTS ---------->
    <section id="projects" class="section" aria-labelledby="projects-title">
      <h2 id="projects-title" class="h" style="font-size:1.6rem">Projects</h2>
      <div class="grid">
        <div class="col-6 card">
          <h3 class="h" style="font-size:1.2rem">Anime</h3>
          <p class="p">Dive into our original series and production notes.</p>
          <div class="actions" style="margin-top:10px"><a class="btn btn-ghost" href="#anime" data-tab="anime">Open Anime</a></div>
        </div>
        <div class="col-6 card">
          <h3 class="h" style="font-size:1.2rem">Games</h3>
          <p class="p">Design logs, builds, and dev progress.</p>
          <div class="actions" style="margin-top:10px"><a class="btn btn-ghost" href="#games" data-tab="games">Open Games</a></div>
        </div>
      </div>
    </section>

    <!---------- PARTNERS ---------->
    <section id="partners" class="section" aria-labelledby="partners-title">
      <h2 id="partners-title" class="h" style="font-size:1.6rem">Partners</h2>
      <p class="p" style="margin-bottom:10px">Creators we vibe with. If they're live, you'll see the stream; if not, enjoy their most recent video or VOD.</p>
      <div class="grid" id="partnersGrid"></div>
    </section>

    <!---------- ANIME ---------->
    <section id="anime" class="section" aria-labelledby="anime-title">
      <h2 id="anime-title" class="h" style="font-size:1.6rem">Anime</h2>
      <div class="grid">
        <div class="col-12 card">
          <h3 class="h" style="font-size:1.2rem">Bloodline Zero</h3>
          <p class="p">A grounded, adult-leaning saga where the hidden world of might-enabled users collides with a relentless organization. Expect arcane relics, seismic power tiers, and a universe where destiny is forged in paradox.</p>
        </div>
        <div class="col-6 card">
          <h4 class="h" style="font-size:1.1rem">Lore & World</h4>
          <p class="p">Timelines, factions, and living myths—refined to avoid plot holes and reward rewatchers.</p>
        </div>
        <div class="col-6 card">
          <h4 class="h" style="font-size:1.1rem">Visual & Voice</h4>
          <p class="p">Cinematic teasers, character sheets, and behind-the-mic sessions as the world takes shape.</p>
        </div>
      </div>
    </section>

    <!---------- GAMES ---------->
    <section id="games" class="section" aria-labelledby="games-title">
      <h2 id="games-title" class="h" style="font-size:1.6rem">Games</h2>
      <div class="grid">
        <div class="col-12 card">
          <h3 class="h" style="font-size:1.2rem">The Adventures of the Troll King</h3>
          <p class="p">A strategic journey across a color-coded hex world—grind smart routes, face world bosses, and chase seasonal leaderboards. Fair, skill-first, and endlessly replayable.</p>
        </div>
        <div class="col-6 card">
          <h4 class="h" style="font-size:1.1rem">Design Notes</h4>
          <p class="p">Seasonal vs. core world balance, ethical monetization, and guild-based cooperation.</p>
        </div>
        <div class="col-6 card">
          <h4 class="h" style="font-size:1.1rem">Progress</h4>
          <p class="p">Godot builds, combat prototypes, and map shaders—documented as features land.</p>
        </div>

        <!-- AtherFall -->
        <div class="col-12 card">
          <h3 class="h" style="font-size:1.2rem">AtherFall</h3>
          <p class="p">Rogue-like tower defense — mankind vs. aliens. Men traveled through time to recruit all walks and creations of life to hold the line against the aether swarm.</p>
          <div class="actions" style="margin-top:10px">
            <a class="btn" id="af-download" href="#">Download</a>
            <a class="btn btn-ghost" id="af-guilds" href="#">Guilds & Members</a>
          </div>
        </div>

        <!-- Live leaderboard renders here -->
        <div class="col-12 card" id="af-leaderboard-card" aria-live="polite">
          <h3 class="h" style="font-size:1.2rem">AtherFall — Best Wave Leaderboard</h3>
          <p class="p" id="lb-status">Loading live data…</p>
          <div class="leaderboard" id="lb-host" style="display:none;"></div>
        </div>
      </div>
    </section>

    <!---------- ABOUT ---------->
    <section id="about" class="section" aria-labelledby="about-title">
      <h2 id="about-title" class="h" style="font-size:1.6rem">About Us</h2>
      <div class="card">
        <p class="p">Zindigon Enterprises is a creative company from anime, game development, and live content. We build worlds for explorers and tell stories for believers—where rules bend, and imagination sets the expectation.</p>
      </div>
    </section>

    <!---------- CONTACT ---------->
    <section id="contact" class="section" aria-labelledby="contact-title">
      <h2 id="contact-title" class="h" style="font-size:1.6rem">Contact</h2>
      <div class="grid">
        <div class="col-6 card" id="support">
          <h3 class="h" style="font-size:1.2rem">Support the Journey</h3>
          <p class="p">Fuel the magic. Every contribution goes back into art, music, servers, and tools.</p>
          <p style="margin-top:10px"><a class="support" href="https://buymeacoffee.com/" target="_blank" rel="noopener">✨ Donate / Tip</a></p>
        </div>
        <div class="col-6 card">
          <h3 class="h" style="font-size:1.2rem">Reach Out</h3>
          <p class="p">Business & collabs: <a href="mailto:brandonjoea3@gmail.com">brandonjoea3@gmail.com</a></p>
          <p class="p">Press & licensing: <a href="mailto:brandonjoea3@gmail.com">brandonjoea3@gmail.com</a></p>
          <p class="p">General: <a href="mailto:brandonjoea3@gmail.com">brandonjoea3@gmail.com</a></p>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div>© <span id="year"></span> Zindigon — All worlds reserved.</div>
  </footer>

  <script>
    //-------------------- Config --------------------
    const SITE_PARENTS = ["zindigon.com","localhost"];

    const PARTNERS = [
      { type:'twitch', name:'Zindigon', gamertag:'Zindigon', joined:'2025-11-01',
        description:'Games, dev logs, and anime vibes.', twitchChannel:'zindigon',
        channelUrl:'https://www.twitch.tv/zindigon', isLive:false },
      { type:'twitch', name:'Spaz', gamertag:'SpaZFUSC', joined:'2025-11-11',
        description:'Highlights, guides, and chill streams.', twitchChannel:'spazfusc',
        channelUrl:'https://www.twitch.tv/spazfusc', isLive:false }
    ];

    //-------------------- Starfield --------------------
    (function(){
      const c=document.getElementById('starfield'); const ctx=c.getContext('2d');
      let w=0,h=0,stars=[];
      function resize(){
        w=c.width=innerWidth*devicePixelRatio; h=c.height=innerHeight*devicePixelRatio;
        ctx.scale(1,1);
        stars=new Array(180).fill(0).map(()=>({x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.3+.2,s:Math.random()*0.6+0.2,hue:200+Math.random()*80}));
      }
      addEventListener('resize', resize, {passive:true}); resize();
      let t=0; (function loop(){
        t+=0.01; ctx.clearRect(0,0,w,h);
        for(const st of stars){
          st.y+=st.s; if(st.y>h) st.y=-10;
          ctx.beginPath();
          const glow=0.45+0.45*Math.sin(t+st.x*0.001);
          ctx.fillStyle=`hsla(${st.hue},100%,${70+glow*20}%,${0.55+glow*0.25})`;
          ctx.shadowBlur=12+glow*18; ctx.shadowColor=ctx.fillStyle;
          ctx.arc(st.x,st.y,st.r,0,Math.PI*2); ctx.fill();
        }
        requestAnimationFrame(loop);
      })();
    })();

    //---------- Tabs ----------
    const sections=document.querySelectorAll('.section');
    const tabBtns=document.querySelectorAll('.tab-btn, a.brand, a.btn[data-tab]');
    function showTab(id){
      sections.forEach(s=>s.classList.toggle('show', s.id===id));
      document.querySelectorAll('.tab-btn').forEach(b=>{
        b.classList.toggle('active', b.dataset.tab===id);
        b.setAttribute('aria-selected', b.classList.contains('active')?'true':'false');
      });
      const el=document.getElementById(id); if(el){ el.scrollIntoView({behavior:'smooth', block:'start'}); }
    }
    tabBtns.forEach(btn=>{
      btn.addEventListener('click', (e)=>{
        const id=btn.dataset.tab||'home';
        if(id){ e.preventDefault(); showTab(id); }
      });
    });
    document.getElementById('year').textContent=new Date().getFullYear();
    const urlParams=new URLSearchParams(location.search); const initial=urlParams.get('tab'); if(initial){ showTab(initial); }

    //-------------------- Partners --------------------
    function twitchEmbedSrc(channel){
      const parents = SITE_PARENTS.map(p=>`parent=${encodeURIComponent(p)}`).join('&');
      return `https://player.twitch.tv/?channel=${encodeURIComponent(channel)}&${parents}&muted=true`;
    }
    function renderPartnerCard(p){
      const col = document.createElement('div');
      col.className = 'col-12 card';
      const wrap = document.createElement('div');
      wrap.className = 'partner-card';

      const media = document.createElement('div');
      const iframe = document.createElement('iframe');
      iframe.className = 'twitch-frame';
      iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
      iframe.allowFullscreen = true;
      iframe.src = twitchEmbedSrc(p.twitchChannel);
      media.appendChild(iframe);

      const meta = document.createElement('div');
      meta.className = 'partner-meta';
      const title = Object.assign(document.createElement('div'), {className:'partner-title h', textContent:p.name});
      const badges = Object.assign(document.createElement('div'), {className:'partner-badges'});
      const tag = Object.assign(document.createElement('span'), {className:'badge', textContent:p.gamertag});
      const joined = Object.assign(document.createElement('span'), {className:'badge', textContent:`Joined ${new Date(p.joined).toLocaleDateString()}`});
      badges.append(tag, joined);
      const desc = Object.assign(document.createElement('p'), {className:'p', textContent:p.description||''});
      const actions = Object.assign(document.createElement('div'), {className:'actions'});
      const link = Object.assign(document.createElement('a'), {className:'btn btn-ghost', href:p.channelUrl, target:'_blank', rel:'noopener', textContent:'Visit Channel'});
      actions.appendChild(link);
      meta.append(title, badges, desc, actions);

      wrap.append(media, meta);
      col.appendChild(wrap);
      return col;
    }
    (function buildPartners(){
      const grid = document.getElementById('partnersGrid');
      grid.innerHTML = '';
      PARTNERS.forEach(p=> grid.appendChild(renderPartnerCard(p)) );
      const feat = PARTNERS[0];
      const fp = document.getElementById('featuredPlayer');
      fp.innerHTML = '';
      const fI = document.createElement('iframe');
      fI.className = 'twitch-frame';
      fI.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share';
      fI.allowFullscreen = true;
      fI.src = twitchEmbedSrc(feat.twitchChannel);
      fp.appendChild(fI);
      const link = document.getElementById('featuredLink'); link.href = feat.channelUrl || '#';
      document.getElementById('featuredMeta').textContent = `${feat.name} — ${feat.gamertag}`;
    })();

    //-------------------- AtherFall: Live Leaderboard --------------------
    const LB_URL = 'https://dashboard.trytalo.com/leaderboards/best_wave';

    async function loadAtherFallLeaderboard(){
      const host = document.getElementById('lb-host');
      const statusEl = document.getElementById('lb-status');

      // 1) Try JSON first (common pattern: add ?format=json, but also try raw)
      try{
        let res = await fetch(LB_URL, {headers:{'Accept':'application/json'}});
        let text = await res.text();
        let data = null;
        try{ data = JSON.parse(text); }catch(_){ /* not JSON */ }

        if(Array.isArray(data)){
          renderLBRows(host, data);
          statusEl.style.display='none'; host.style.display='block'; return;
        }

        // 2) Not JSON? Try to parse HTML table body
        const doc = new DOMParser().parseFromString(text, 'text/html');
        const table = doc.querySelector('table');
        if(table){
          const rows = [...table.querySelectorAll('tbody tr')].map((tr,i)=>{
            const cells = [...tr.children].map(td=>td.textContent.trim());
            return { rank: cells[0] || (i+1), name: cells[1] || '', guild: cells[2] || '', best_wave: cells[3] || cells[cells.length-1] || '' };
          });
          renderLBRows(host, rows);
          statusEl.style.display='none'; host.style.display='block'; return;
        }

        // If we got here, content was unexpected — fallback to iframe
        fallbackIframe(host, statusEl);
      } catch(err){
        // Likely CORS block — fallback to iframe
        fallbackIframe(host, statusEl);
      }
    }

    function renderLBRows(host, rows){
      // Normalize keys from either JSON shape or parsed HTML
      const norm = rows.map((r,i)=>({
        rank: Number(r.rank ?? (r.position ?? i+1)),
        name: r.name ?? r.player ?? r.username ?? 'Unknown',
        guild: r.guild ?? r.team ?? r.clan ?? '-',
        best_wave: r.best_wave ?? r.bestWave ?? r.score ?? r.level ?? r.highest_level ?? ''
      }));

      host.innerHTML = `
        <div class="leaderboard">
          <table class="lb-table">
            <thead>
              <tr>
                <th class="lb-rank">Rank</th>
                <th>Player</th>
                <th>Guild</th>
                <th class="lb-score">Best Wave</th>
              </tr>
            </thead>
            <tbody>
              ${norm.map(r => `
                <tr class="lb-row">
                  <td class="lb-rank">${r.rank ?? ''}</td>
                  <td class="lb-name">${escapeHTML(r.name)}</td>
                  <td class="lb-guild">${escapeHTML(r.guild)}</td>
                  <td class="lb-score">${escapeHTML(String(r.best_wave))}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        </div>
      `;
    }

    function fallbackIframe(host, statusEl){
      statusEl.innerHTML = `<span class="lb-bad">Couldn’t fetch cross-origin data. Showing embedded leaderboard.</span>`;
      host.style.display='block';
      host.innerHTML = `
        <iframe src="${LB_URL}" style="width:100%; height:640px; border:0; border-radius:12px; box-shadow:var(--shadow); background:#0c0c20;"></iframe>
      `;
    }

    function escapeHTML(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    // Kick it off
    loadAtherFallLeaderboard();

    //-------------------- Wire misc --------------------
    // Example placeholder links (replace later)
    document.getElementById('af-download').href = '#';
    document.getElementById('af-guilds').href = '#';
  </script>
</body>
</html>
